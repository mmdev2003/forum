services:
  forum-thread-unit-test:
    container_name: forum-thread-unit-test
    build:
      context: "../../../"
      dockerfile: ".github/test/unit/Dockerfile"
    depends_on:
      - forum-thread-db-unit-test
      - forum-meilisearch-thread-unit-test
    networks:
      - net

  forum-thread-db-unit-test:
    image: postgres:latest
    container_name: forum-thread-db-unit-test
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: postgres
    ports:
      - "10003:5432"
    restart: unless-stopped
    networks:
      - net

  forum-meilisearch-thread-unit-test:
    image: getmeili/meilisearch
    container_name: forum-meilisearch-thread-unit-test
    ports:
      - "7700:7700"
    environment:
      - MEILI_MASTER_KEY=qwertyuiop
      - MEILI_LOG_LEVEL=error
    networks:
      - net

  forum-thread-weed-master-unit-test:
    image: chrislusf/seaweedfs
    logging:
      driver: none
    container_name: forum-thread-weed-master-unit-test
    ports:
      - "9333:9333"
    command: "master"
    networks:
      - net

  forum-thread-weed-volume-unit-test:
    image: chrislusf/seaweedfs
    container_name: forum-thread-weed-volume-unit-test
    logging:
      driver: none
    ports:
      - "8080:8080"
    command: 'volume -mserver="forum-thread-weed-master-unit-test:9333" -port=8080'
    depends_on:
      - forum-thread-weed-master-unit-test
    networks:
      - net

  forum-thread-weed-filer-unit-test:
    image: chrislusf/seaweedfs
    container_name: forum-thread-weed-filer-unit-test
    logging:
      driver: none
    ports:
      - "8888:8888"
    command: 'filer -master="forum-thread-weed-master-unit-test:9333"'
    depends_on:
      - forum-thread-weed-master-unit-test
      - forum-thread-weed-volume-unit-test
    networks:
      - net

networks:
  net: