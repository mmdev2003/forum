# Микросервисная форум-система на Go

## Обзор проекта

Данный проект представляет собой высокопроизводительную, масштабируемую форум-систему, построенную по принципам микросервисной архитектуры. Система предназначена для создания современных интернет-сообществ с расширенным функционалом социального взаимодействия, монетизацией и системой управления контентом.

## Бизнес-цель

Система решает задачи создания активного пользовательского сообщества с возможностями:
- **Монетизации** через систему статусов, рамок и платежей
- **Модерации контента** с автоматизированными процессами
- **Уведомлений в реальном времени** для повышения вовлеченности
- **Поддержки пользователей** через интегрированную тикет-систему
- **Масштабирования** под высокие нагрузки

## Архитектурный подход

### Микросервисная архитектура
Система разделена на 11 независимых микросервисов, каждый из которых отвечает за конкретную бизнес-область:

#### Основные сервисы
1. **forum-authentication** - Аутентификация и управление аккаунтами
2. **forum-authorization** - Авторизация и JWT-токены  
3. **forum-thread** - Управление темами, подфорумами и сообщениями
4. **forum-dialog** - Личные сообщения и диалоги
5. **forum-user** - Профили пользователей и пользовательский контент
6. **forum-notification** - Система уведомлений
7. **forum-support** - Тикет-система поддержки
8. **forum-admin** - Административные функции
9. **forum-payment** - Платежная система с поддержкой криптовалют
10. **forum-status** - Система статусов пользователей
11. **forum-frame** - Система декоративных рамок профилей

### Технологический стек

#### Backend
- **Язык**: Go 1.23
- **Web Framework**: Echo v4
- **База данных**: PostgreSQL с pgx драйвером
- **Кеширование**: Redis
- **Очереди сообщений**: RabbitMQ  
- **Файловое хранилище**: SeaweedFS (distributed file system)
- **Поиск**: MeiliSearch (full-text search)
- **Валидация**: Custom validator

#### Infrastructure
- **Контейнеризация**: Docker + Docker Compose
- **Proxy**: Nginx
- **Мониторинг**: Структурированные логи (slog)
- **CI/CD**: GitHub Actions
- **Деплой**: Self-hosted на VPS

## Ключевые архитектурные особенности

### 1. Clean Architecture
Каждый микросервис следует принципам Clean Architecture:
```
internal/
├── app/server/           # Точка входа и конфигурация сервера
├── controller/          # HTTP handlers, middleware, WebSocket
├── service/             # Бизнес-логика
├── repo/               # Слой доступа к данным
└── model/              # Модели данных и интерфейсы
```

### 2. Event-Driven архитектура
- **Асинхронная обработка** через RabbitMQ для трудоемких операций
- **Постпроцессинг** (например, отправка уведомлений после создания сообщения)
- **Децентрализованные воркеры** для обработки очередей

### 3. Распределенные WebSocket соединения
- **Pod-aware WebSocket manager** с Redis для синхронизации
- **Horizontal scaling** WebSocket соединений между инстансами
- **Real-time уведомления** и сообщения

### 4. Система разрешений
- **Status-based permissions** - права доступа основаны на статусах пользователей
- **Гибкая конфигурация** разрешений через код
- **Ролевая модель** (user, admin, support)

### 5. Межсервисная коммуникация
- **HTTP API** для синхронных вызовов
- **Message Queues** для асинхронных операций  
- **Shared models** через внутренние пакеты
- **Circuit breaker pattern** (потенциал для добавления)

## Функциональные возможности

### Пользовательский функционал
- **Регистрация/аутентификация** с 2FA (TOTP)
- **Создание тем и сообщений** с файловыми вложениями
- **Система лайков** с различными типами реакций
- **Личные сообщения** с real-time доставкой
- **Поиск** по сообщениям и пользователям
- **Настраиваемые уведомления**

### Модерация и администрирование
- **Премодерация контента** для новых тем
- **Система жалоб** с тикет-системой поддержки
- **Бан-система** и предупреждения
- **Закрытие тем** администраторами

### Монетизация
- **Платные статусы** с дополнительными возможностями
- **Декоративные рамки** профилей
- **Криптоплатежи** (Bitcoin) с автоматическим подтверждением
- **Временные и постоянные подписки**

### Система статусов
- **Agent**: Доступ к эксклюзивным разделам, возможность создавать больше тем
- **Reader**: Расширенные права на чтение и участие в дискуссиях  
- **Автоматическое присвоение** статусов на основе активности

## Масштабируемость и производительность

### Горизонтальное масштабирование
- **Независимое масштабирование** каждого микросервиса
- **Stateless сервисы** с externalized конфигурацией
- **Database per service** pattern

### Производительность
- **Connection pooling** для баз данных
- **Индексы** для критических запросов
- **Кеширование** через Redis
- **Асинхронная обработка** тяжелых операций

### Отказоустойчивость
- **Health checks** для всех сервисов
- **Graceful shutdown** с завершением активных запросов
- **Database transactions** для консистентности данных
- **Retry механизмы** в очередях сообщений

## Безопасность

### Аутентификация и авторизация
- **JWT токены** с коротким временем жизни (15 минут)
- **Refresh tokens** для бесшовного обновления сессий
- **2FA через TOTP** для дополнительной защиты
- **Inter-service authentication** через секретные ключи

### Защита данных
- **bcrypt** для хеширования паролей с pepper
- **SQL injection protection** через prepared statements
- **XSS protection** через правильную валидацию
- **HTTPS-only** cookies для токенов

## Мониторинг и наблюдаемость

### Логирование
- **Структурированные логи** (JSON) с контекстом
- **Request ID** для трассировки запросов
- **Централизованные логи** со всех сервисов

### Метрики
- **Request duration** и success rate
- **Database connection** метрики
- **Queue processing** статистика

## Развертывание и эксплуатация

### Автоматизация
- **Docker Compose** для локальной разработки
- **GitHub Actions** для CI/CD
- **Automated testing** через unit тесты
- **Database migrations** через SQL скрипты

### Конфигурация
- **Environment-specific** конфиги
- **Health check endpoints** для всех сервисов
- **Graceful deployment** с zero-downtime

## Заключение

Данная форум-система представляет собой современное, технически продвинутое решение, способное обслуживать большие сообщества с высокими требованиями к производительности и функциональности. Микросервисная архитектура обеспечивает гибкость в развитии и масштабировании, а богатый функционал создает основу для успешного интернет-сообщества с возможностями монетизации.

Система демонстрирует лучшие практики современной разработки на Go и может служить референсным примером для подобных проектов.
